<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-store" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Run Emulator</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        color: #333;
        padding: 20px;
        box-sizing: border-box; /* Ensure padding doesn't add to element size */
      }

      .terminal {
        background-color: black;
        color: #00FF00;
        padding: 10px;
        border-radius: 5px;
        font-family: 'Courier New', Courier, monospace;
        font-size: 14px;
        font-weight: normal;
        height: 50vh; /* Set height to 50% of the viewport height */
        width: 100%; /* Set width to 100% of the parent container */
        overflow-y: scroll;
        white-space: pre-wrap;
        box-sizing: border-box; /* Ensure padding doesn't add to element size */
        resize: both; /* Allow manual resizing by the user */
      }

      #execute-button, #help-button {
        margin-top: 10px;
      }

      .form-group {
        margin-bottom: 10px;
      }

      .terminal.white-text {
        color: white !important;
      }

      .help-section {
        display: none;
        margin-top: 20px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #fff;
      }

      ul {
        padding: 20;
      }

      ul li {
        padding-bottom: 10px; /* Add some space between the text and the line */
      }

      ul li:last-child {
        border-bottom: 1px solid #ccc; /* Draw the line under the last item */
      }
    </style>
  </head>
  <body>
    <form id="run-form">
      <div class="form-group">
        <label for="argument">Enter Argument:</label>
        <input type="text" id="argument" name="argument">
      </div>
      <div class="form-group">
        <label>
          <input type="checkbox" id="include-summary" name="include-summary"> Include summary </label>
      </div>
      <button type="submit" id="execute-button">Execute</button>
      <button type="button" id="help-button">Help</button>
    </form>
    
    <div id="help-section" class="help-section">
      <h4>The following command line arguments are valid:</h4>
      <ul>
        <li>-t, --test=VALUE     Execute a cycle test.</li>
        <li>-r, --rept=VALUE     Set the number of test repetitions.</li>
        <li>-v, --ver            Print the version and exit.</li>
        <li>-c, --cgi            Enable web CGI mode.</li>
        <li>-h, -?, --help       Print usage.</li>
        <li><b style="color: blue;">-t=?</b>, show all supported tests.</li>
        <li><b style="color: blue;">-t=1 -r=10</b>, execute test one 4 times.</li>
      </ul>
    </div>

    <h3>Output:</h3>
    <div class="terminal" id="output"></div>

    <script>
      window.onload = function() {
        document.getElementById('run-form').addEventListener('submit', function(event) {
          event.preventDefault();
          const argument = document.getElementById('argument').value;
          const includeSummary = document.getElementById('include-summary').checked ? 'yes' : 'no';

          // Clear the terminal box when the Execute button is clicked
          document.getElementById('output').innerHTML = '';

          fetch(`/cgi-bin/runemu.cgi?arg=-c ${encodeURIComponent(argument)}&summary=${includeSummary}`)
            .then(response => response.text())
            .then(data => {
              if (data.includes("<hidden-correct-print>")) {
                const parts = data.split("<hidden-correct-print>");
                const beforeMarker = parts[0];
                const afterMarker = parts[1];

                document.getElementById('output').innerHTML = `<span style="color: #00FF00;">${beforeMarker}</span>`;
                document.getElementById('output').innerHTML += `<span style="color: white;">${afterMarker}</span>`;
              } else {
                document.getElementById('output').innerHTML = `<span style="color: #00FF00;">${data}</span>`;
              }
            })
            .catch(error => {
              document.getElementById('output').textContent = 'Error: ' + error;
            });
        });

        document.getElementById('help-button').addEventListener('click', function() {
          const helpSection = document.getElementById('help-section');
          if (helpSection.style.display === 'none') {
            helpSection.style.display = 'block';
          } else {
            helpSection.style.display = 'none';
          }
        });
      };
    </script>
  </body>
</html>
